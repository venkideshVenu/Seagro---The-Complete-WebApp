{% extends 'layouts/base.html' %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-3">
            <div class="accordion" id="accordionExample">
                <div class="card" style="margin:10px 0;">
                    <div class="collapse show" aria-labelledby="" data-parent="#accordionExample">
                        <div class="card-body" style="padding:0;">
                            <table style="width: 100%;">
                                {% for lesson in lessons %}
                                    <tr style="width: 100%; padding: 5px 0px;" 
                                        class="lesson-row {% if current_lesson.id == lesson.id %}active-lesson{% endif %}">
                                        <td style="text-align: left; padding:10px; border-bottom:1px solid #ccc;">
                                            <a href="{% url 'learning_centre:course-lessons-single' slug=course.slug id=lesson.id %}"
                                               class="lesson-link"
                                               data-video-url="{{ lesson.video_url }}"
                                               id="lesson-{{ lesson.id }}">
                                                <i class="fa fa-play"
                                                   style="font-size: 12px;color: #909090;padding: 10px;"></i>
                                                {{ lesson.title }}
                                            </a>
                                        </td>
                                        <td style="text-align: right; padding:10px; border-bottom:1px solid #ccc;">
                                            <span class="lesson_duration">
                                                {{ lesson.duration | floatformat:2 }}
                                            </span>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-9" id="video_player_area">
            <div class="" style="background-color: #333;">
                <div class="embed-responsive embed-responsive-16by9">
                    {% if current_lesson %}
                        <iframe width="100%" 
                                height="500" 
                                class="embed-responsive-item"
                                id="video-iframe"
                                src="{{ current_lesson.video_url }}" 
                                frameborder="0"
                                allowfullscreen>
                        </iframe>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .active-lesson {
        background-color: #f8f9fa;
    }
    .lesson-link {
        text-decoration: none;
        color: #333;
        display: block;
    }
    .lesson-link:hover {
        color: #5fcf80;
    }
    .active-lesson .lesson-link {
        color: #5fcf80;
    }
    .active-lesson .fa-play {
        color: #5fcf80 !important;
    }
</style>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const videoIframe = document.getElementById('video-iframe');
        const lessonLinks = document.querySelectorAll('.lesson-link');
        
        function transformVideoUrl(url) {
            if (url.includes('youtube.com/watch?v=')) {
                const videoId = url.split('watch?v=')[1];
                return `https://www.youtube.com/embed/${videoId}?autoplay=0&rel=0`;
            }
            return url;
        }
        
        lessonLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelector('.active-lesson')?.classList.remove('active-lesson');
                this.closest('tr').classList.add('active-lesson');
                window.history.pushState({}, '', this.href);
                videoIframe.src = transformVideoUrl(this.getAttribute('data-video-url'));
            });
        });
    });
    </script>


{% endblock %}